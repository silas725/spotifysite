<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Spotify Overlay</title>
    <style>
        body {
            background: #111;
            color: #fff;
            font-family: sans-serif;
            margin: 0; 
            padding: 0;
            text-align: center;
        }
        .container {
            width: 250px;
            margin: 0 auto;
            padding-top: 10px;
        }
        img {
            width: 100%;
            border-radius: 12px;
            margin-bottom: 12px;
        }
        .track {
            font-size: 16px;
            font-weight: 600;
        }
        .artist {
            font-size: 13px;
            color: #aaa;
            margin-bottom: 8px;
        }
        #progress-container {
            width: 100%;
            height: 6px;
            background: #222;
            border-radius: 4px;
            overflow: hidden;
        }
        #progress-bar {
            height: 100%;
            width: 0%;
            background: #1DB954;
            transition: width 0.2s linear;
        }
    </style>
</head>
<body>
    <div class="container" id="ov-now"></div>
    <script>
    function formatSong(np) {
      return `
        <img src="${np.albumArt}" alt="Album art">
        <div class="track">${np.name}</div>
        <div class="artist">${np.artists}</div>
        <div id="progress-container">
            <div id="progress-bar"></div>
        </div>
      `;
    }
    function updateOverlay() {
      const el = document.getElementById('ov-now');
      const raw = localStorage.getItem('overlay_nowplaying');
      if (!raw) { el.innerHTML = '<div>Not playingâ€¦</div>'; return; }
      const np = JSON.parse(raw);

      el.innerHTML = formatSong(np);

      // Progress bar
      const bar = document.getElementById('progress-bar');
      const songElapsed = Math.min(Date.now() - np.timestamp + np.position, np.duration);
      const pct = Math.max(0, Math.min(songElapsed / np.duration, 1)) * 100;
      bar.style.width = pct + "%";
    }
    setInterval(updateOverlay, 1000);
    updateOverlay();
    </script>
</body>
</html>
